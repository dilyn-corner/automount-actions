#!/bin/sh

: ${WATCH_FILE:=/tmp/mounts.fifo}; readonly WATCH_FILE

mklog() {
    _log_dir="${1:-"${LOG_DIR:="$(mktemp -d)"}"}"

    [ -d "$_log_dir" ] || mkdir -p "$_log_dir"

    echo "${_log_dir}/$(date -Iseconds).log"
}

init_log() {
    _arg_log_file="$1"
    _arg_log_dir="$(dirname "$_arg_log_file")"

    [ -d "$_arg_log_dir" ] || mkdir -p "$_arg_log_dir"

    touch "$_arg_log_file"
}

# log to SNAP_COMMON and TTY
log() {
    printf '%s %s\n' \
        "$(date -Iseconds)" "$*" | tee -a "${_log_file}" >&2
}
